!function(exports,Laya){"use strict";class HTMLExtendStyle{constructor(){this.reset()}reset(){return this.stroke=0,this.strokeColor="#000000",this.leading=0,this.lineHeight=0,this.letterSpacing=0,this.href=null,this}recover(){this!=HTMLExtendStyle.EMPTY&&Laya.Pool.recover("HTMLExtendStyle",this.reset())}static create(){return Laya.Pool.getItemByClass("HTMLExtendStyle",HTMLExtendStyle)}}HTMLExtendStyle.EMPTY=new HTMLExtendStyle;class HTMLStyle{constructor(){this.padding=HTMLStyle._PADDING,this.reset()}_getExtendStyle(){return this._extendStyle===HTMLExtendStyle.EMPTY&&(this._extendStyle=HTMLExtendStyle.create()),this._extendStyle}get href(){return this._extendStyle.href}set href(value){value!==this._extendStyle.href&&(this._getExtendStyle().href=value)}get stroke(){return this._extendStyle.stroke}set stroke(value){this._extendStyle.stroke!==value&&(this._getExtendStyle().stroke=value)}get strokeColor(){return this._extendStyle.strokeColor}set strokeColor(value){this._extendStyle.strokeColor!==value&&(this._getExtendStyle().strokeColor=value)}get leading(){return this._extendStyle.leading}set leading(value){this._extendStyle.leading!==value&&(this._getExtendStyle().leading=value)}get lineHeight(){return this._extendStyle.lineHeight}set lineHeight(value){this._extendStyle.lineHeight!==value&&(this._getExtendStyle().lineHeight=value)}set align(v){v in HTMLStyle.alignVDic&&(this._type&=~HTMLStyle._ALIGN,this._type|=HTMLStyle.alignVDic[v])}get align(){var v=this._type&HTMLStyle._ALIGN;return HTMLStyle.align_Value[v]}set valign(v){v in HTMLStyle.alignVDic&&(this._type&=~HTMLStyle._VALIGN,this._type|=HTMLStyle.alignVDic[v])}get valign(){var v=this._type&HTMLStyle._VALIGN;return HTMLStyle.vAlign_Value[v]}set font(value){for(var strs=value.split(" "),i=0,n=strs.length;i<n;i++){var str=strs[i];switch(str){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}str.indexOf("px")>0&&(this.fontSize=parseInt(str),this.family=strs[i+1],i++)}}get font(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Laya.ILaya.Browser.onIPhone&&Laya.ILaya.Text.fontFamilyMap[this.family]||this.family)}set block(value){value?this._type|=HTMLStyle._CSS_BLOCK:this._type&=~HTMLStyle._CSS_BLOCK}get block(){return 0!=(this._type&HTMLStyle._CSS_BLOCK)}reset(){return this.ower=null,this._type=0,this.wordWrap=!0,this.fontSize=Laya.ILaya.Text.defaultFontSize,this.family=Laya.ILaya.Text.defaultFont,this.color="#000000",this.valign=HTMLStyle.VALIGN_TOP,this.padding=HTMLStyle._PADDING,this.bold=!1,this.italic=!1,this.align=HTMLStyle.ALIGN_LEFT,this.textDecoration=null,this.bgColor=null,this.borderColor=null,this._extendStyle&&this._extendStyle.recover(),this._extendStyle=HTMLExtendStyle.EMPTY,this}recover(){Laya.Pool.recover("HTMLStyle",this.reset())}static create(){return Laya.Pool.getItemByClass("HTMLStyle",HTMLStyle)}inherit(src){var i,len,props,key;for(len=(props=HTMLStyle._inheritProps).length,i=0;i<len;i++)this[key=props[i]]=src[key]}get wordWrap(){return 0==(this._type&HTMLStyle._NOWARP)}set wordWrap(value){value?this._type&=~HTMLStyle._NOWARP:this._type|=HTMLStyle._NOWARP}get bold(){return 0!=(this._type&HTMLStyle._BOLD)}set bold(value){value?this._type|=HTMLStyle._BOLD:this._type&=~HTMLStyle._BOLD}get italic(){return 0!=(this._type&HTMLStyle._ITALIC)}set italic(value){value?this._type|=HTMLStyle._ITALIC:this._type&=~HTMLStyle._ITALIC}_widthAuto(){return 0!=(this._type&HTMLStyle._WIDTHAUTO)}widthed(sprite){return 0!=(this._type&HTMLStyle._WIDTH_SET)}set whiteSpace(type){"nowrap"===type&&(this._type|=HTMLStyle._NOWARP),"none"===type&&(this._type&=~HTMLStyle._NOWARP)}get whiteSpace(){return this._type&HTMLStyle._NOWARP?"nowrap":""}_calculation(type,value){return!1}set width(w){if(this._type|=HTMLStyle._WIDTH_SET,"string"==typeof w){var offset=w.indexOf("auto");if(offset>=0&&(this._type|=HTMLStyle._WIDTHAUTO,w=w.substr(0,offset)),this._calculation("width",w))return;w=parseInt(w)}this.size(w,-1)}set height(h){if(this._type|=HTMLStyle._HEIGHT_SET,"string"==typeof h){if(this._calculation("height",h))return;h=parseInt(h)}this.size(-1,h)}heighted(sprite){return 0!=(this._type&HTMLStyle._HEIGHT_SET)}size(w,h){var ower=this.ower,resize=!1;-1!==w&&w!=ower.width&&(this._type|=HTMLStyle._WIDTH_SET,ower.width=w,resize=!0),-1!==h&&h!=ower.height&&(this._type|=HTMLStyle._HEIGHT_SET,ower.height=h,resize=!0),resize&&ower._layoutLater()}getLineElement(){return 0!=(this._type&HTMLStyle._LINE_ELEMENT)}setLineElement(value){value?this._type|=HTMLStyle._LINE_ELEMENT:this._type&=~HTMLStyle._LINE_ELEMENT}_enableLayout(){return 0==(this._type&HTMLStyle._DISPLAY_NONE)&&0==(this._type&HTMLStyle._ABSOLUTE)}get letterSpacing(){return this._extendStyle.letterSpacing}set letterSpacing(d){"string"==typeof d&&(d=parseInt(d+"")),d!=this._extendStyle.letterSpacing&&(this._getExtendStyle().letterSpacing=d)}cssText(text){this.attrs(HTMLStyle.parseOneCSS(text,";"))}attrs(attrs){if(attrs)for(var i=0,n=attrs.length;i<n;i++){var attr=attrs[i];this[attr[0]]=attr[1]}}set position(value){"absolute"===value?this._type|=HTMLStyle._ABSOLUTE:this._type&=~HTMLStyle._ABSOLUTE}get position(){return this._type&HTMLStyle._ABSOLUTE?"absolute":""}get absolute(){return 0!=(this._type&HTMLStyle._ABSOLUTE)}get paddingLeft(){return this.padding[3]}get paddingTop(){return this.padding[0]}static parseOneCSS(text,clipWord){for(var valueArray,out=[],attrs=text.split(clipWord),i=0,n=attrs.length;i<n;i++){var attr=attrs[i],ofs=attr.indexOf(":"),name=attr.substr(0,ofs).replace(/^\s+|\s+$/g,"");if(0!==name.length){var value=attr.substr(ofs+1).replace(/^\s+|\s+$/g,""),one=[name,value];switch(name){case"italic":case"bold":one[1]="true"==value;break;case"font-weight":"bold"==value&&(one[1]=!0,one[0]="bold");break;case"line-height":one[0]="lineHeight",one[1]=parseInt(value);break;case"font-size":one[0]="fontSize",one[1]=parseInt(value);break;case"stroke":one[0]="stroke",one[1]=parseInt(value);break;case"padding":(valueArray=value.split(" ")).length>1||(valueArray[1]=valueArray[2]=valueArray[3]=valueArray[0]),one[1]=[parseInt(valueArray[0]),parseInt(valueArray[1]),parseInt(valueArray[2]),parseInt(valueArray[3])];break;default:(one[0]=HTMLStyle._CSSTOVALUE[name])||(one[0]=name)}out.push(one)}}return out}static parseCSS(text,uri){for(var one;null!=(one=HTMLStyle._parseCSSRegExp.exec(text));)HTMLStyle.styleSheets[one[1]]=HTMLStyle.parseOneCSS(one[2],";")}}HTMLStyle._CSSTOVALUE={"letter-spacing":"letterSpacing","white-space":"whiteSpace","line-height":"lineHeight","font-family":"family","vertical-align":"valign","text-decoration":"textDecoration","background-color":"bgColor","border-color":"borderColor"},HTMLStyle._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),HTMLStyle._inheritProps=["italic","align","valign","leading","stroke","strokeColor","bold","fontSize","lineHeight","wordWrap","color"],HTMLStyle.ALIGN_LEFT="left",HTMLStyle.ALIGN_CENTER="center",HTMLStyle.ALIGN_RIGHT="right",HTMLStyle.VALIGN_TOP="top",HTMLStyle.VALIGN_MIDDLE="middle",HTMLStyle.VALIGN_BOTTOM="bottom",HTMLStyle.styleSheets={},HTMLStyle.ADDLAYOUTED=512,HTMLStyle._PADDING=[0,0,0,0],HTMLStyle._HEIGHT_SET=8192,HTMLStyle._LINE_ELEMENT=65536,HTMLStyle._NOWARP=131072,HTMLStyle._WIDTHAUTO=262144,HTMLStyle._BOLD=1024,HTMLStyle._ITALIC=2048,HTMLStyle._CSS_BLOCK=1,HTMLStyle._DISPLAY_NONE=2,HTMLStyle._ABSOLUTE=4,HTMLStyle._WIDTH_SET=8,HTMLStyle.alignVDic={left:0,center:16,right:32,top:0,middle:64,bottom:128},HTMLStyle.align_Value={0:"left",16:"center",32:"right"},HTMLStyle.vAlign_Value={0:"top",64:"middle",128:"bottom"},HTMLStyle._ALIGN=48,HTMLStyle._VALIGN=192;class HTMLDocument{constructor(){this.all=[],this.styleSheets=HTMLStyle.styleSheets}getElementById(id){return this.all[id]}setElementById(id,e){this.all[id]=e}}HTMLDocument.document=new HTMLDocument;class HTMLHitRect{constructor(){this.rec=new Laya.Rectangle,this.reset()}reset(){return this.rec.reset(),this.href=null,this}recover(){Laya.Pool.recover("HTMLHitRect",this.reset())}static create(){return Laya.Pool.getItemByClass("HTMLHitRect",HTMLHitRect)}}class IHtml{}IHtml.HTMLDivElement=null,IHtml.HTMLImageElement=null,IHtml.HTMLBrElement=null,IHtml.HTMLDivParser=null,IHtml.HTMLParse=null,IHtml.HTMLElementType=null;class LayoutLine{constructor(){this.elements=[],this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0}updatePos(left,width,lineNum,dy,align,valign,lineHeight){var one,w=0;this.elements.length>0&&(w=(one=this.elements[this.elements.length-1]).x+one.width-this.elements[0].x),lineHeight=lineHeight||this.h;var ddy,dx=0;align===HTMLStyle.ALIGN_CENTER&&(dx=(width-w)/2),align===HTMLStyle.ALIGN_RIGHT&&(dx=width-w);for(var i=0,n=this.elements.length;i<n;i++){var tCSSStyle=(one=this.elements[i])._getCSSStyle();switch(0!==dx&&(one.x+=dx),tCSSStyle.valign){case"top":one.y=dy;break;case"middle":var tMinTextHeight=0;99999!=this.minTextHeight&&(tMinTextHeight=this.minTextHeight);var tBottomLineY=(tMinTextHeight+lineHeight)/2;tBottomLineY=Math.max(tBottomLineY,this.h),ddy=(one.eletype,IHtml.HTMLElementType.IMAGE,dy+tBottomLineY-one.height),one.y=ddy;break;case"bottom":one.y=dy+(lineHeight-one.height)}}}}class Layout{static later(element){null==Layout._will&&(Layout._will=[],Laya.ILaya.stage.frameLoop(1,null,function(){if(!(Layout._will.length<1)){for(var i=0;i<Layout._will.length;i++)Layout.layout(Layout._will[i]);Layout._will.length=0}})),Layout._will.push(element)}static layout(element){return element&&element._style?0==(element._style._type&HTMLStyle.ADDLAYOUTED)?null:(element.style._type&=~HTMLStyle.ADDLAYOUTED,Layout._multiLineLayout(element)):null}static _multiLineLayout(element){var elements=[];element._addChildsToLayout(elements);var i,oneLayout,curStyle,curPadding,newLine,htmlWord,sprite,n=elements.length,style=element._getCSSStyle(),letterSpacing=style.letterSpacing,leading=style.leading,lineHeight=style.lineHeight,widthAuto=style._widthAuto()||!style.wordWrap,width=widthAuto?999999:element.width,maxWidth=(element.height,0),exWidth=style.italic?style.fontSize/3:0,align=style.align,valign=style.valign,endAdjust=valign!==HTMLStyle.VALIGN_TOP||align!==HTMLStyle.ALIGN_LEFT||0!=lineHeight,x=0,y=0,w=0,h=0,lines=[],curLine=lines[0]=new LayoutLine,nextNewline=!1;curLine.h=0,style.italic&&(width-=style.fontSize/3);var tWordWidth=0,tLineFirstKey=!0;function addLine(){curLine.y=y,y+=curLine.h+leading,curLine.mWidth=tWordWidth,tWordWidth=0,curLine=new LayoutLine,lines.push(curLine),curLine.h=0,x=0,tLineFirstKey=!0,newLine=!1}for(i=0;i<n;i++)if(null!=(oneLayout=elements[i]))if(tLineFirstKey=!1,oneLayout instanceof IHtml.HTMLBrElement)addLine(),curLine.y=y,curLine.h=lineHeight;else{if(oneLayout._isChar()){if((htmlWord=oneLayout).isWord)newLine=nextNewline||"\n"===htmlWord.char,curLine.wordStartIndex=curLine.elements.length;else{if(lines.length>0&&x+w>width&&curLine.wordStartIndex>0){var tLineWord;tLineWord=curLine.elements.length-curLine.wordStartIndex+1,curLine.elements.length=curLine.wordStartIndex,i-=tLineWord,addLine();continue}newLine=!1,tWordWidth+=htmlWord.width}w=htmlWord.width+htmlWord.style.letterSpacing,h=htmlWord.height,nextNewline=!1,(newLine=newLine||x+w>width)&&addLine(),curLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height)}else curStyle=oneLayout._getCSSStyle(),sprite=oneLayout,curPadding=curStyle.padding,newLine=nextNewline||curStyle.getLineElement(),w=sprite.width+curPadding[1]+curPadding[3]+curStyle.letterSpacing,h=sprite.height+curPadding[0]+curPadding[2],nextNewline=curStyle.getLineElement(),(newLine=newLine||x+w>width&&curStyle.wordWrap)&&addLine();curLine.elements.push(oneLayout),curLine.h=Math.max(curLine.h,h),oneLayout.x=x,oneLayout.y=y,x+=w,curLine.w=x-letterSpacing,curLine.y=y,maxWidth=Math.max(x+exWidth,maxWidth)}else tLineFirstKey||(x+=Layout.DIV_ELEMENT_PADDING),curLine.wordStartIndex=curLine.elements.length;if(y=curLine.y+curLine.h,endAdjust){var tY=0,tWidth=width;for(widthAuto&&element.width>0&&(tWidth=element.width),i=0,n=lines.length;i<n;i++)lines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight),tY+=Math.max(lineHeight,lines[i].h+leading);y=tY}return widthAuto&&(element.width=maxWidth),y>element.height&&(element.height=y),[maxWidth,y]}}var HTMLElementType;Layout.DIV_ELEMENT_PADDING=0,(HTMLElementType=exports.HTMLElementType||(exports.HTMLElementType={}))[HTMLElementType.BASE=0]="BASE",HTMLElementType[HTMLElementType.IMAGE=1]="IMAGE";class HTMLElement{constructor(){this.eletype=exports.HTMLElementType.BASE,this._creates(),this.reset()}static formatURL1(url,basePath=null){if(!url)return"null path";if(basePath||(basePath=Laya.URL.basePath),url.indexOf(":")>0)return url;if(null!=Laya.URL.customFormat&&(url=Laya.URL.customFormat(url)),url.indexOf(":")>0)return url;var char1=url.charAt(0);if("."===char1)return Laya.URL._formatRelativePath(basePath+url);if("~"===char1)return Laya.URL.rootPath+url.substring(1);if("d"===char1){if(0===url.indexOf("data:image"))return url}else if("/"===char1)return url;return basePath+url}_creates(){this._style=HTMLStyle.create()}reset(){if(this.URI=null,this.parent=null,this._style.reset(),this._style.ower=this,this._style.valign="middle",this._text&&this._text.words){var i,len,tChar,words=this._text.words;for(len=words.length,i=0;i<len;i++)(tChar=words[i])&&tChar.recover()}return this._text=HTMLElement._EMPTYTEXT,this._children&&(this._children.length=0),this._x=this._y=this._width=this._height=0,this}_getCSSStyle(){return this._style}_addChildsToLayout(out){var words=this._getWords();if(null==words&&(!this._children||0==this._children.length))return!1;if(words)for(var i=0,n=words.length;i<n;i++)out.push(words[i]);return this._children&&this._children.forEach(function(o,index,array){var _style=o._style;_style._enableLayout&&_style._enableLayout()&&o._addToLayout(out)}),!0}_addToLayout(out){if(this._style){var style=this._style;style.absolute||(style.block?out.push(this):this._addChildsToLayout(out)&&(this.x=this.y=0))}}set id(value){HTMLDocument.document.setElementById(value,this)}repaint(recreate=!1){this.parentRepaint(recreate)}parentRepaint(recreate=!1){this.parent&&this.parent.repaint(recreate)}set innerTEXT(value){this._text===HTMLElement._EMPTYTEXT?this._text={text:value,words:null}:(this._text.text=value,this._text.words&&(this._text.words.length=0)),this.repaint()}get innerTEXT(){return this._text.text}_setParent(value){if(value instanceof HTMLElement){var p=value;this.URI||(this.URI=p.URI),this.style&&this.style.inherit(p.style)}}appendChild(c){return this.addChild(c)}addChild(c){return c.parent&&c.parent.removeChild(c),this._children||(this._children=[]),this._children.push(c),c.parent=this,c._setParent(this),this.repaint(),c}removeChild(c){if(!this._children)return null;var i,len;for(len=this._children.length,i=0;i<len;i++)if(this._children[i]==c)return this._children.splice(i,1),c;return null}static getClassName(tar){return tar instanceof Function?tar.name:tar.constructor.name}destroy(){this._children&&(this.destroyChildren(),this._children.length=0),Laya.Pool.recover(HTMLElement.getClassName(this),this.reset())}destroyChildren(){if(this._children){for(var i=this._children.length-1;i>-1;i--)this._children[i].destroy();this._children.length=0}}get style(){return this._style}_getWords(){if(!this._text)return null;var txt=this._text.text;if(!txt||0===txt.length)return null;var size,words=this._text.words;if(words&&words.length===txt.length)return words;null===words&&(this._text.words=words=[]),words.length=txt.length;for(var style=this.style,fontStr=style.font,i=0,n=txt.length;i<n;i++)size=Laya.ILaya.Browser.measureText(txt.charAt(i),fontStr),words[i]=Laya.HTMLChar.create().setData(txt.charAt(i),size.width,size.height||style.fontSize,style);return words}_isChar(){return!1}_layoutLater(){var style=this.style;style._type&HTMLStyle.ADDLAYOUTED||(style.widthed(this)&&(this._children&&this._children.length>0||null!=this._getWords())&&style.block?(Layout.later(this),style._type|=HTMLStyle.ADDLAYOUTED):this.parent&&this.parent._layoutLater())}set x(v){this._x!=v&&(this._x=v,this.parentRepaint())}get x(){return this._x}set y(v){this._y!=v&&(this._y=v,this.parentRepaint())}get y(){return this._y}get width(){return this._width}set width(value){this._width!==value&&(this._width=value,this.repaint())}get height(){return this._height}set height(value){this._height!==value&&(this._height=value,this.repaint())}_setAttributes(name,value){switch(name){case"style":this.style.cssText(value);break;case"class":this.className=value;break;case"x":this.x=parseFloat(value);break;case"y":this.y=parseFloat(value);break;case"width":this.width=parseFloat(value);break;case"height":this.height=parseFloat(value);break;default:this[name]=value}}set href(url){this._style&&url!=this._style.href&&(this._style.href=url,this.repaint())}get href(){return this._style?this._style.href:null}formatURL(url){return this.URI?HTMLElement.formatURL1(url,this.URI?this.URI.path:null):url}set color(value){this.style.color=value}set className(value){this.style.attrs(HTMLDocument.document.styleSheets["."+value])}drawToGraphic(graphic,gX,gY,recList){gX+=this.x,gY+=this.y;var i,len,tChild,cssStyle=this.style;if(cssStyle.paddingLeft&&(gX+=cssStyle.paddingLeft),cssStyle.paddingTop&&(gY+=cssStyle.paddingTop),(null!=cssStyle.bgColor||cssStyle.borderColor)&&graphic.drawRect(gX,gY,this.width,this.height,cssStyle.bgColor,cssStyle.borderColor,1),this.renderSelfToGraphic(graphic,gX,gY,recList),this._children&&this._children.length>0)for(len=this._children.length,i=0;i<len;i++)null!=(tChild=this._children[i]).drawToGraphic&&tChild.drawToGraphic(graphic,gX,gY,recList)}renderSelfToGraphic(graphic,gX,gY,recList){var cssStyle=this.style,words=this._getWords();if(words&&(words.length,cssStyle)){var font=cssStyle.font,color=cssStyle.color;if(cssStyle.stroke){var stroke=cssStyle.stroke;stroke=parseInt(stroke);var strokeColor=cssStyle.strokeColor;graphic.fillBorderWords(words,gX,gY,font,color,strokeColor,stroke)}else graphic.fillWords(words,gX,gY,font,color);if(this.href){var lastWords=words[words.length-1],lineY=lastWords.y+lastWords.height;if(lastWords.y==words[0].y){"none"!=cssStyle.textDecoration&&graphic.drawLine(words[0].x,lineY,lastWords.x+lastWords.width,lineY,color,1);var hitRec=HTMLHitRect.create();hitRec.rec.setTo(words[0].x,lastWords.y,lastWords.x+lastWords.width-words[0].x,lastWords.height),hitRec.href=this.href,recList.push(hitRec)}else this.workLines(words,graphic,recList)}}}workLines(wordList,g,recList){var hasLine,i,len,tStartWord,tEndWord;if(hasLine="none"!=this.style.textDecoration,len=wordList.length,tEndWord=tStartWord=wordList[i],tStartWord){var tword;for(i=1;i<len;i++)(tword=wordList[i]).y!=tStartWord.y?(this.createOneLine(tStartWord,tEndWord,hasLine,g,recList),tStartWord=tword,tEndWord=tword):tEndWord=tword;this.createOneLine(tStartWord,tEndWord,hasLine,g,recList)}}createOneLine(startWord,lastWords,hasLine,graphic,recList){var lineY=lastWords.y+lastWords.height;hasLine&&graphic.drawLine(startWord.x,lineY,lastWords.x+lastWords.width,lineY,this.color,1);var hitRec=HTMLHitRect.create();hitRec.rec.setTo(startWord.x,lastWords.y,lastWords.x+lastWords.width-startWord.x,lastWords.height),hitRec.href=this.href,recList.push(hitRec)}}HTMLElement._EMPTYTEXT={text:null,words:null},Laya.ILaya.regClass(HTMLElement),IHtml.HTMLElementType=exports.HTMLElementType;class HTMLBrElement{_addToLayout(out){out.push(this)}reset(){return this}destroy(){Laya.Pool.recover(HTMLElement.getClassName(this),this.reset())}_setParent(value){}set parent(value){}set URI(value){}set href(value){}_getCSSStyle(){return HTMLBrElement.brStyle||(HTMLBrElement.brStyle=new HTMLStyle,HTMLBrElement.brStyle.setLineElement(!0),HTMLBrElement.brStyle.block=!0),HTMLBrElement.brStyle}renderSelfToGraphic(graphic,gX,gY,recList){}}IHtml.HTMLBrElement=HTMLBrElement,Laya.ILaya.regClass(HTMLBrElement);class HTMLStyleElement extends HTMLElement{_creates(){}drawToGraphic(graphic,gX,gY,recList){}reset(){return this}set innerTEXT(value){HTMLStyle.parseCSS(value,null)}get innerTEXT(){return super.innerTEXT}}Laya.ILaya.regClass(HTMLStyleElement);class HTMLLinkElement extends HTMLElement{_creates(){}drawToGraphic(graphic,gX,gY,recList){}reset(){return this._loader&&this._loader.off(Laya.Event.COMPLETE,this,this._onload),this._loader=null,this}_onload(data){switch(this._loader&&(this._loader=null),this.type){case"text/css":HTMLStyle.parseCSS(data,this.URI)}this.repaint(!0)}set href(url){url&&(url=this.formatURL(url),this.URI=new Laya.URL(url),this._loader&&this._loader.off(Laya.Event.COMPLETE,this,this._onload),Laya.Loader.getRes(url)?"text/css"==this.type&&HTMLStyle.parseCSS(Laya.Loader.getRes(url),this.URI):(this._loader=new Laya.Loader,this._loader.once(Laya.Event.COMPLETE,this,this._onload),this._loader.load(url,Laya.Loader.TEXT)))}get href(){return super.href}}HTMLLinkElement._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),Laya.ILaya.regClass(HTMLLinkElement);class HTMLDivParser extends HTMLElement{constructor(){super(...arguments),this.repaintHandler=null}reset(){return super.reset(),this._style.block=!0,this._style.setLineElement(!0),this._style.width=200,this._style.height=200,this.repaintHandler=null,this.contextHeight=0,this.contextWidth=0,this}set innerHTML(text){this.destroyChildren(),this.appendHTML(text)}set width(value){var changed;changed=0===value?value!=this._width:value!=this.width,super.width=value,changed&&this.layout()}appendHTML(text){IHtml.HTMLParse.parse(this,text,this.URI),this.layout()}_addChildsToLayout(out){var words=this._getWords();if(null==words&&(!this._children||0==this._children.length))return!1;words&&words.forEach(function(o){out.push(o)});for(var tFirstKey=!0,i=0,len=this._children.length;i<len;i++){var o=this._children[i];tFirstKey?tFirstKey=!1:out.push(null),o._addToLayout(out)}return!0}_addToLayout(out){this.layout(),!this.style.absolute&&out.push(this)}getBounds(){return this._htmlBounds?(this._boundsRec||(this._boundsRec=Laya.Rectangle.create()),this._boundsRec.copyFrom(this._htmlBounds)):null}parentRepaint(recreate=!1){super.parentRepaint(),this.repaintHandler&&this.repaintHandler.runWith(recreate)}layout(){this.style._type|=HTMLStyle.ADDLAYOUTED;var tArray=Layout.layout(this);if(tArray){this._htmlBounds||(this._htmlBounds=Laya.Rectangle.create());var tRectangle=this._htmlBounds;tRectangle.x=tRectangle.y=0,tRectangle.width=this.contextWidth=tArray[0],tRectangle.height=this.contextHeight=tArray[1]}}get height(){return this._height?this._height:this.contextHeight}set height(value){super.height=value}get width(){return this._width?this._width:this.contextWidth}}IHtml.HTMLDivParser=HTMLDivParser,Laya.ILaya.regClass(HTMLDivParser);class HTMLParse{static getInstance(type){var rst=Laya.Pool.getItem(HTMLParse._htmlClassMapShort[type]);return rst||(rst=Laya.ClassUtils.getInstance(type)),rst}static parse(ower,xmlString,url){xmlString=(xmlString="<root>"+(xmlString=xmlString.replace(/<br>/g,"<br/>"))+"</root>").replace(HTMLParse.spacePattern,HTMLParse.char255);var xml=Laya.Utils.parseXMLFromString(xmlString);HTMLParse._parseXML(ower,xml.childNodes[0].childNodes,url)}static _parseXML(parent,xml,url,href=null){var i,n;if(xml.join||xml.item)for(i=0,n=xml.length;i<n;++i)HTMLParse._parseXML(parent,xml[i],url,href);else{var node,nodeName,txt;if(3==xml.nodeType)return void(parent instanceof IHtml.HTMLDivParser?(null==xml.nodeName&&(xml.nodeName="#text"),nodeName=xml.nodeName.toLowerCase(),(txt=xml.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(node=HTMLParse.getInstance(nodeName))&&(parent.addChild(node),node.innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," "))):(txt=xml.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(parent.innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," ")));if("#comment"==(nodeName=xml.nodeName.toLowerCase()))return;if(node=HTMLParse.getInstance(nodeName)){"p"==nodeName?(parent.addChild(HTMLParse.getInstance("br")),node=parent.addChild(node),parent.addChild(HTMLParse.getInstance("br"))):node=parent.addChild(node),node.URI=url,node.href=href;var attributes=xml.attributes;if(attributes&&attributes.length>0)for(i=0,n=attributes.length;i<n;++i){var attribute=attributes[i],attrName=attribute.nodeName,value=attribute.value;node._setAttributes(attrName,value)}HTMLParse._parseXML(node,xml.childNodes,url,node.href)}else HTMLParse._parseXML(parent,xml.childNodes,url,href)}}}HTMLParse.char255=String.fromCharCode(255),HTMLParse.spacePattern=/&nbsp;|&#160;/g,HTMLParse.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),HTMLParse._htmlClassMapShort={div:HTMLDivParser,p:HTMLElement,img:HTMLImageElement,span:HTMLElement,br:HTMLBrElement,style:HTMLStyleElement,font:HTMLElement,a:HTMLElement,"#text":HTMLElement,link:HTMLLinkElement},IHtml.HTMLParse=HTMLParse,Laya.ClassUtils.regClass("div",HTMLDivParser),Laya.ClassUtils.regClass("p",HTMLElement),Laya.ClassUtils.regClass("img",HTMLImageElement),Laya.ClassUtils.regClass("span",HTMLElement),Laya.ClassUtils.regClass("br",HTMLBrElement),Laya.ClassUtils.regClass("style",HTMLStyleElement),Laya.ClassUtils.regClass("font",HTMLElement),Laya.ClassUtils.regClass("a",HTMLElement),Laya.ClassUtils.regClass("#text",HTMLElement),Laya.ClassUtils.regClass("link",HTMLLinkElement);class HTMLDivElement extends Laya.Sprite{constructor(){super(),this._recList=[],this._repaintState=0,this._element=new HTMLDivParser,this._element.repaintHandler=new Laya.Handler(this,this._htmlDivRepaint),this.mouseEnabled=!0,this.on(Laya.Event.CLICK,this,this._onMouseClick)}destroy(destroyChild=!0){this._element&&this._element.reset(),this._element=null,this._doClears(),super.destroy(destroyChild)}_htmlDivRepaint(recreate=!1){recreate?this._repaintState<2&&(this._repaintState=2):this._repaintState<1&&(this._repaintState=1),this._repaintState>0&&this._setGraphicDirty()}_updateGraphicWork(){switch(this._repaintState){case 1:this._updateGraphic();break;case 2:this._refresh()}}_setGraphicDirty(){this.callLater(this._updateGraphicWork)}_doClears(){if(this._recList){var i,len=this._recList.length;for(i=0;i<len;i++)this._recList[i].recover();this._recList.length=0}}_updateGraphic(){this._doClears(),this.graphics.clear(!0),this._repaintState=0,this._element.drawToGraphic(this.graphics,-this._element.x,-this._element.y,this._recList);var bounds=this._element.getBounds();bounds&&this.setSelfBounds(bounds),this.size(bounds.width,bounds.height)}get style(){return this._element.style}set innerHTML(text){this._innerHTML!=text&&(this._repaintState=1,this._innerHTML=text,this._element.innerHTML=text,this._setGraphicDirty())}_refresh(){this._repaintState=1,this._innerHTML&&(this._element.innerHTML=this._innerHTML),this._setGraphicDirty()}get contextWidth(){return this._element.contextWidth}get contextHeight(){return this._element.contextHeight}_onMouseClick(){var i,len,tHit,tX=this.mouseX,tY=this.mouseY;for(len=this._recList.length,i=0;i<len;i++)(tHit=this._recList[i]).rec.contains(tX,tY)&&this._eventLink(tHit.href)}_eventLink(href){this.event(Laya.Event.LINK,[href])}}IHtml.HTMLDivElement=HTMLDivElement,IHtml.HTMLParse=HTMLParse;class HTMLImageElement$1 extends HTMLElement{constructor(){super(),this.eletype=exports.HTMLElementType.IMAGE}reset(){return super.reset(),this._tex&&this._tex.off(Laya.Event.LOADED,this,this.onloaded),this._tex=null,this._url=null,this}set src(url){if(url=this.formatURL(url),this._url!==url){this._url=url;var tex=this._tex=Laya.Loader.getRes(url);tex||(this._tex=tex=new Laya.Texture,tex.load(url),Laya.Loader.cacheRes(url,tex)),tex.getIsReady()?this.onloaded():tex.once(Laya.Event.READY,this,this.onloaded)}}onloaded(){if(this._style){var style=this._style;style.widthed(this)||this._tex.width,style.heighted(this)||this._tex.height;style.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),style.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),this.repaint()}}_addToLayout(out){!this._style.absolute&&out.push(this)}renderSelfToGraphic(graphic,gX,gY,recList){this._tex&&graphic.drawImage(this._tex,gX,gY,this.width||this._tex.width,this.height||this._tex.height)}}IHtml.HTMLImageElement=HTMLImageElement$1,Laya.ILaya.regClass(HTMLImageElement$1),exports.HTMLBrElement=HTMLBrElement,exports.HTMLDivElement=HTMLDivElement,exports.HTMLDivParser=HTMLDivParser,exports.HTMLDocument=HTMLDocument,exports.HTMLElement=HTMLElement,exports.HTMLExtendStyle=HTMLExtendStyle,exports.HTMLHitRect=HTMLHitRect,exports.HTMLIframeElement=class extends HTMLDivElement{constructor(){super(),this._element._getCSSStyle().valign="middle"}set href(url){url=this._element.formatURL(url);var l=new Laya.Loader;l.once(Laya.Event.COMPLETE,null,function(data){var pre=this._element.URI;this._element.URI=new Laya.URL(url),this.innerHTML=data,!pre||(this._element.URI=pre)}),l.load(url,Laya.Loader.TEXT)}},exports.HTMLImageElement=HTMLImageElement$1,exports.HTMLLinkElement=HTMLLinkElement,exports.HTMLParse=HTMLParse,exports.HTMLStyle=HTMLStyle,exports.HTMLStyleElement=HTMLStyleElement,exports.IHtml=IHtml,exports.Layout=Layout,exports.LayoutLine=LayoutLine}(window.Laya=window.Laya||{},Laya);